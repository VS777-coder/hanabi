<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hanabi Mobile - 7-Slot Precision</title>
    <style>
        :root {
            --s: calc(100vh / 14);
            --red: #ff0044; --blue: #0040ff; --gray: #222;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            background: #000; color: #fff; font-family: sans-serif;
            margin: 0; height: 100svh; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* 上部：成立役・状態設定 */
        header { padding: 4px; background: #111; display: flex; flex-direction: column; gap: 4px; }
        .row { display: flex; gap: 4px; }
        label { flex: 1; height: 44px; position: relative; }
        input { display: none; }
        span {
            display: flex; align-items: center; justify-content: center; height: 100%;
            background: #2a2a2a; border: 1px solid #444; border-radius: 4px;
            font-size: 11px; font-weight: bold; color: #888;
        }
        input:checked + span { border-color: #fff; color: #fff; background: #444; }
        
        /* フラグ固有色 */
        .btn-don:checked + span { background: #b71c1c; }
        .btn-seven:checked + span { background: #880e4f; }
        .btn-bar:checked + span { background: #333; }
        .btn-rep:checked + span { background: #0080ff; color: #fff; }
        .btn-ice:checked + span { background: #00bb00; color: #fff; }
        .btn-cherry:checked + span { background: #ff0000; color: #fff; }
        .btn-bell:checked + span { background: #eebb00; color: #000; }

        /* メインエリア：リール表示 */
        main {
            flex: 1; display: flex; align-items: center; justify-content: space-around;
            padding: 10px; position: relative;
        }
        .reel-unit {
            display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        .reel-label { font-size: 10px; color: #aaa; letter-spacing: 1px; }

        /* 7コマ表示用コンテナ */
        .reel-window {
            width: 90px; height: calc(var(--s) * 7);
            background: #111; overflow: hidden; position: relative;
            border: 2px solid #333;
        }
        .strip { width: 100%; position: absolute; transition: transform 0.1s ease-out; }
        .symbol {
            width: 100%; height: var(--s);
            background-image: url('hanabi.png');
            background-size: 100% 2100%;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        /* 中央の数値表示 */
        .center-display {
            display: flex; flex-direction: column; align-items: center;
            min-width: 80px; gap: 5px;
        }
        .val-label { font-size: 10px; color: #666; }
        .val-big { font-size: 48px; font-weight: bold; font-family: monospace; line-height: 1; color: #fff; }
        .val-sub { font-size: 18px; color: var(--red); font-weight: bold; }

        /* 赤枠（停止位置を3コマ分囲む） */
        .frame-red {
            position: absolute; top: calc(var(--s) * 2); left: -2px;
            width: calc(100% + 4px); height: calc(var(--s) * 3);
            border: 3px solid var(--red); z-index: 10;
            box-shadow: inset 0 0 15px rgba(255,0,68,0.3);
            pointer-events: none;
        }
        /* 青枠（入力位置） */
        .frame-blue {
            position: absolute; top: calc(var(--s) * 2); left: -2px;
            width: calc(100% + 4px); height: calc(var(--s) * 3);
            border: 3px solid #00e5ff; z-index: 10;
            pointer-events: none;
        }

        /* 下部：実行ボタン */
        footer { padding: 10px; background: #111; }
        .exec-btn {
            width: 100%; height: 60px; background: linear-gradient(#444, #222);
            border: 2px solid #666; border-radius: 8px; color: #fff;
            font-size: 20px; font-weight: bold; letter-spacing: 5px;
            box-shadow: 0 4px 0 #000;
        }
        .exec-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #000; }
    </style>
</head>
<body>

<header>
    <div class="row">
        <label><input type="radio" name="state" value="hazure" checked><span>通常</span></label>
        <label><input type="radio" name="state" value="don_flag" class="btn-don"><span>ドン成立</span></label>
        <label><input type="radio" name="state" value="seven_flag" class="btn-seven"><span>七成立</span></label>
        <label><input type="radio" name="state" value="bar_flag" class="btn-bar"><span>REG成立</span></label>
    </div>
    <div class="row">
        <label><input type="radio" name="flag" value="hazure" checked><span>ハズレ</span></label>
        <label><input type="radio" name="flag" value="normal_rep" class="btn-rep"><span>リプレイ</span></label>
        <label><input type="radio" name="flag" value="ice" class="btn-ice"><span>氷</span></label>
        <label><input type="radio" name="flag" value="cherry" class="btn-cherry"><span>チェリー</span></label>
        <label><input type="radio" name="flag" value="bell" class="btn-bell"><span>ベル</span></label>
    </div>
</header>

<main>
    <div class="reel-unit">
        <div class="reel-label">INPUT</div>
        <div class="reel-window" id="touch-area">
            <div class="frame-blue"></div>
            <div id="strip-in" class="strip"></div>
        </div>
    </div>

    <div class="center-display">
        <span class="val-label">SLIP</span>
        <div id="val-slip" class="val-big">0</div>
        <div id="val-pos" class="val-sub">POS --</div>
    </div>

    <div class="reel-unit">
        <div class="reel-label">OUTPUT</div>
        <div class="reel-window">
            <div class="frame-red"></div>
            <div id="strip-out" class="strip"></div>
        </div>
    </div>
</main>

<footer>
    <button class="exec-btn" onclick="updateLogic()">ANALYZE</button>
</footer>

<script>
    // hanabi.html の神データを完全移植
    const GOD_DATA = {
        hazure: { hazure:[2,2,0,1,1,1,2,3,4,0,1,2,3,4,0,1,2,1,0,1,0], normal_rep:[0,1,2,3,4,0,1,2,3,4,0,1,2,3,4,0,1,2,3,4,0], ice:[3,4,0,1,2,3,4,0,1,2,3,4,0,1,2,3,4,0,1,2,3], cherry:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], bell:[1,1,3,3,4,0,1,1,1,1,1,3,3,4,0,1,1,1,1,2,0] },
        don_flag: { hazure:[2,2,4,4,0,1,2,3,4,1,0,2,2,3,0,1,0,0,0,0,0], normal_rep:[0,1,2,3,4,0,1,2,3,4,0,4,2,3,4,0,1,0,3,2,3], ice:[2,3,4,4,0,1,2,3,4,0,2,2,4,4,0,1,0,1,2,3,1], cherry:[4,0,1,0,1,2,3,4,4,1,2,0,1,0,1,2,3,4,1,2,3], bell:[1,1,2,4,0,1,1,2,4,0,2,4,2,4,0,1,2,3,4,2,1] },
        seven_flag: { hazure:[1,1,3,3,0,1,0,0,0,1,1,1,3,3,4,1,2,3,4,1,1], normal_rep:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3], ice:[2,1,4,3,0,0,1,1,1,1,2,2,4,4,0,1,1,2,2,3,1], cherry:[4,0,1,0,1,2,3,4,1,1,2,0,1,0,1,2,3,4,1,2,3], bell:[2,2,4,4,0,1,1,1,0,1,0,1,2,3,0,1,0,1,2,0,0] },
        bar_flag: { hazure:[1,1,3,3,0,1,0,0,0,1,1,1,3,3,0,1,2,3,4,1,1], normal_rep:[0,1,2,3,4,0,1,0,1,2,0,1,2,3,4,0,1,0,1,2,3], ice:[2,1,4,3,0,0,1,1,0,0,2,2,4,4,0,1,2,3,4,3,1], cherry:[4,0,1,0,1,2,3,4,0,1,2,0,1,0,1,2,3,4,4,2,3], bell:[1,1,2,4,0,1,1,2,4,0,0,4,2,3,0,1,2,3,4,2,1] }
    };

    let selectedIdx = 18; // 中段狙い位置 (1-21)
    const SH = window.innerHeight / 14;

    function createStrip(id) {
        const el = document.getElementById(id);
        // 7コマ表示だが、上下ループをスムーズにするため多めに生成
        for(let i=0; i<63; i++) {
            const symIdx = (i % 21) + 1;
            const d = document.createElement('div');
            d.className = 'symbol';
            d.style.backgroundPosition = `0 ${(21 - symIdx) * 5}%`;
            el.appendChild(d);
        }
    }

    function updateReels() {
        // 入力側を移動（中段が選択位置になるようオフセット計算）
        const inStrip = document.getElementById('strip-in');
        inStrip.style.transform = `translateY(${-(21 + selectedIdx - 4) * SH}px)`;
        updateLogic();
    }

    function updateLogic() {
        const state = document.querySelector('input[name="state"]:checked').value;
        const flag = document.querySelector('input[name="flag"]:checked').value;

        // hanabi.html ロジック：中段インデックスをそのまま配列キーに
        const slip = GOD_DATA[state][flag][selectedIdx - 1];
        let stopIdx = selectedIdx + slip;
        if(stopIdx > 21) stopIdx -= 21;

        // 数値更新
        document.getElementById('val-slip').innerText = slip;
        document.getElementById('val-pos').innerText = `POS ${stopIdx}`;

        // 出力側を移動
        const outStrip = document.getElementById('strip-out');
        outStrip.style.transform = `translateY(${-(21 + stopIdx - 4) * SH}px)`;
    }

    // タッチ操作（入力リールの操作）
    const touchArea = document.getElementById('touch-area');
    let sy = 0, csy = 0;
    touchArea.addEventListener('touchstart', e => { sy = e.touches[0].pageY; csy = 0; });
    touchArea.addEventListener('touchmove', e => {
        let move = e.touches[0].pageY - sy;
        let step = Math.round(move / 25);
        if(step !== csy) {
            selectedIdx += (step > csy ? -1 : 1);
            if(selectedIdx > 21) selectedIdx = 1;
            else if(selectedIdx < 1) selectedIdx = 21;
            csy = step;
            updateReels();
        }
    });

    window.onload = () => {
        createStrip('strip-in');
        createStrip('strip-out');
        updateReels();
    };
</script>
</body>
</html>